.PHONY: help generate-style clean build run test

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
PYTHON := python3
FLUTTER := flutter
SCRIPT_DIR := scripts
ASSETS_DIR := assets/map
STYLE_FILE := $(ASSETS_DIR)/style_dark_gold.json

help: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

generate-style: ## –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∏–ª—å –∫–∞—Ä—Ç—ã —Å API –∫–ª—é—á–æ–º
	@echo "üé® –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç–∏–ª—è –∫–∞—Ä—Ç—ã..."
	@if [ -z "$(MAPTILER_API_KEY)" ]; then \
		echo "‚ùå –û—à–∏–±–∫–∞: MAPTILER_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"; \
		echo "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è: export MAPTILER_API_KEY='–≤–∞—à_–∫–ª—é—á'"; \
		exit 1; \
	fi
	powershell -ExecutionPolicy Bypass -File $(SCRIPT_DIR)/generate_map_style.ps1
	@echo "‚úÖ –°—Ç–∏–ª—å –∫–∞—Ä—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω: $(STYLE_FILE)"

clean: ## –û—á–∏—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ —Å–±–æ—Ä–∫–∏..."
	$(FLUTTER) clean
	@echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

get-deps: ## –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
	@echo "üì¶ –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
	$(FLUTTER) pub get
	@echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω—ã"

build: generate-style get-deps ## –°–æ–±—Ä–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
	@echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	$(FLUTTER) build apk --debug
	@echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

build-release: generate-style get-deps ## –°–æ–±—Ä–∞—Ç—å —Ä–µ–ª–∏–∑–Ω—É—é –≤–µ—Ä—Å–∏—é
	@echo "üî® –°–±–æ—Ä–∫–∞ —Ä–µ–ª–∏–∑–Ω–æ–π –≤–µ—Ä—Å–∏–∏..."
	$(FLUTTER) build apk --release
	@echo "‚úÖ –†–µ–ª–∏–∑–Ω–∞—è —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

run: generate-style get-deps ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
	$(FLUTTER) run
	@echo "‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ"

test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	$(FLUTTER) test
	@echo "‚úÖ –¢–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã"

analyze: ## –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
	@echo "üîç –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞..."
	$(FLUTTER) analyze
	@echo "‚úÖ –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω"

format: ## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
	@echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	$(FLUTTER) format .
	@echo "‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

dev-setup: generate-style get-deps ## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
	@echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
	@echo "‚úÖ –°—Ç–∏–ª—å –∫–∞—Ä—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω"
	@echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–ª—É—á–µ–Ω—ã"
	@echo "üéØ –ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!"

# –ö–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
.DEFAULT_GOAL := help
